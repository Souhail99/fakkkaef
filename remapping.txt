import os
import re
import subprocess
import git

# Chemin vers le répertoire de travail où les contrats sont récupérés
repo_path = "/chemin/vers/dossier/depot/"

# Cloner le dépôt
repo_url = "https://github.com/utilisateur/depot.git"
git.Repo.clone_from(repo_url, repo_path)

# Parcourir les fichiers Solidity
solidity_files = [f for f in os.listdir(repo_path) if f.endswith(".sol")]

# Analyser les instructions import et extraire les dépendances
dependencies = set()
for file_name in solidity_files:
    with open(os.path.join(repo_path, file_name), "r") as file:
        content = file.read()
        imports = re.findall(r"import\s+.*?;\s*", content)
        for imp in imports:
            dep = imp.split(" ")[1].replace(";", "").strip()
            dependencies.add(dep)

# Installer les dépendances
for dep in dependencies:
    # Exécuter la commande d'installation (exemple avec pip)
    subprocess.run(["pip", "install", dep])
    # Vous pouvez ajuster cette étape en fonction des outils de gestion de paquets spécifiques à Solidity (ex : truffle, brownie, etc.)

# Compiler les contrats Solidity
# ... Ajoutez ici le code pour la compilation des contrats


# Commande Git pour initialiser les sous-modules
git_command = ["git", "submodule", "update", "--init", "--recursive"]

# Exécution de la commande Git
subprocess.run(git_command, cwd=repo_path)


import os

def trouver_fichiers_sol(chemin_dossier):
    fichiers_sol = []
    # Parcourir récursivement le dossier et ses sous-dossiers
    for root, dirs, files in os.walk(chemin_dossier):
        # Pour chaque fichier dans le dossier actuel
        for file in files:
            # Vérifier si le fichier a l'extension .sol
            if file.endswith(".sol"):
                # Ajouter le chemin complet du fichier à la liste
                chemin_fichier = os.path.join(root, file)
                fichiers_sol.append(chemin_fichier)
    return fichiers_sol

# Exemple d'utilisation
chemin_dossier = "/chemin/vers/votre/dossier"
fichiers_sol = trouver_fichiers_sol(chemin_dossier)
print(fichiers_sol)

